<!DOCTYPE html>
<html>
<head>
    <title>Asset Correlation Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 960px;
            margin: auto;
            padding: 20px;
        }

        h1 {
            color: #333;
        }

        select {
            padding: 10px;
            width: 200px;
            margin-right: 20px;
        }

        .explanation {
            margin-top: 20px;
            font-size: 18px;
            color: #666;
            padding: 30px;
        }
    </style>
</head>
<body>
  <div class="container">
    <h1>Crypto Asset Correlation Tracker</h1>
    <p>Select two assets to view their historical correlation:</p>
    <select id="asset1"></select>
    <select id="asset2"></select>
    <button onclick="updateChart()">Update Chart</button>
</div>

  <iframe id="chart" style="
    width: 100%;
    height: 600px;
"></iframe>

<p class="explanation">
  This webpage tracks the historical correlation between different assets. I built this page, because it's difficult to find Bitcoin and Ethereum correlation charts on the internet. The correlations are calculated over several rolling time horizons. The charts are based on daily closing prices over the past five years. Correlation is a statistical measure that expresses the extent to which two variables move in relation to each other. If the two assets have a positive correlation, it means the prices of both assets tend to move in the same direction. Conversely, if the correlation is negative, the prices of the assets tend to move in opposite directions.
</p>

<p class="explanation">
  This code is open source and can be found here: https://github.com/josusanmartin/correlations
</p>

  <script>
    var displayNames;
    var assets;
    var dropdown1 = document.getElementById('asset1');
    var dropdown2 = document.getElementById('asset2');

    // Load assets and display names from JSON files
    var xhr1 = new XMLHttpRequest();
    xhr1.open('GET', 'json/display_names.json', false);
    xhr1.onreadystatechange = function() {
      if (xhr1.readyState === 4 && xhr1.status === 200) {
        displayNames = JSON.parse(xhr1.responseText);
      }
    };
    xhr1.send();

    var xhr2 = new XMLHttpRequest();
    xhr2.open('GET', 'json/name_to_symbol.json', false);
    xhr2.onreadystatechange = function() {
      if (xhr2.readyState === 4 && xhr2.status === 200) {
        assets = JSON.parse(xhr2.responseText);
      }
    };
    xhr2.send();

    displayNames.forEach(function(name) {
      dropdown1.options.add(new Option(name, name));
      dropdown2.options.add(new Option(name, name));
    });
    dropdown2.selectedIndex = 1;  // Start with a different asset in the second dropdown

    function updateChart() {
      var asset1 = assets[dropdown1.value];
      var asset2 = assets[dropdown2.value];
      var correlationChartUrl = "html/" + asset1.replace('^', '_').replace('=', '_') + "_vs_" + asset2.replace('^', '_').replace('=', '_') + "_correlation.html";
      var reversedCorrelationChartUrl = "html/" + asset2.replace('^', '_').replace('=', '_') + "_vs_" + asset1.replace('^', '_').replace('=', '_') + "_correlation.html";
      if (doesChartExist(correlationChartUrl)) {
        document.getElementById('chart').src = correlationChartUrl;
      } else if (doesChartExist(reversedCorrelationChartUrl)) {
        document.getElementById('chart').src = reversedCorrelationChartUrl;
      }
    }

    function doesChartExist(url) {
      var http = new XMLHttpRequest();
      http.open('HEAD', url, false);
      http.send();
      return http.status !== 404;
    }

    updateChart();  // Display the initial chart

    dropdown1.addEventListener('change', function() {
      if (this.value === dropdown2.value) {
        dropdown2.selectedIndex = (this.selectedIndex + 1) % displayNames.length;
      }
    });
    dropdown2.addEventListener('change', function() {
      if (this.value === dropdown1.value) {
        dropdown1.selectedIndex = (this.selectedIndex + 1) % displayNames.length;
      }
    });
  </script>
</body>
</html>
